// Document Ready
function initGraph(){var e=$.url().param();$(e).keys().each(function(t,n){$("#graphoptions").append($("<input>").attr({type:"hidden",name:n,value:e[n]}))});var t={setupfile:"StateDEM",image:{graphdiv:"graphs",zoomlevels:"8",zoomSliderAxis:"vertical"},functions:{pre_click:"console.log('pre_click:'+element_type+' '+renderer)",post_mouseenter:function(e,t,n,r,i){var s=this.renderers.GraphImage.tooltip.outerWidth()/2;this.renderers.GraphImage.tooltipOffsetX=-s;this.renderers.GraphImage.tooltipOffsetY=-20},post_click:function(e,t,n,r,i){toggleInfocard(n)}}};gf=new NodeViz(t)}function toggleInfocard(e){var t=$("#infocard"),n=t.data("data-node");if(t.is(":hidden")||n!==e.id){t.data("data-node",e.id);$("#node-title").html(e.label+' <span class="district '+e.party+' ">'+e.district+"</span>");var r=e.image.split("www");$("#node-image img").attr("src",r[1]);var i=[{year:2008,contributions:12345},{year:2009,contributions:23456},{year:2010,contributions:34567},{year:2011,contributions:45678},{year:2012,contributions:56789}],s=[{group:"pirates",label:"Pirates",contributions:123456},{group:"ninja",label:"Ninjas",contributions:234567},{group:"robots",label:"Robots",contributions:345678}],o=[{group:"D",label:"Democrats",contributions:123456},{group:"R",label:"Republicans",contributions:234567}];t.slideDown();drawPieChart(s,"#node-piechart1");drawPieChart(o,"#node-piechart2");drawBarChart(i,"#node-barchart");$("#masthead").hide()}else resetGraph()}function resetGraph(){$("#infocard").slideUp();$("#masthead").fadeIn(2e3)}function drawBarChart(e,t){var n=$(t).width(),r=$(t).height(),i=d3.scale.linear().domain([0,e.length]).range([0,n]),s=d3.scale.linear().domain([0,d3.max(e,function(e){return e.contributions})]).rangeRound([0,r]),o=d3.select(t).append("svg").attr("width",n).attr("height",r),u=o.selectAll(".bar").data(e).enter().append("rect").attr("class","bar").attr("x",function(e,t){return i(t)}).attr("y",function(e){return r-s(e.contributions)}).attr("height",function(e){return s(e.contributions)}).attr("width",function(){return n/e.length*.9});o.selectAll(".amount").data(e).enter().append("text").attr("class","amount").attr("x",function(t,r){return i(r)+n/e.length*.9/2}).attr("y",function(e){return r-s(e.contributions)}).attr("dy","2em").attr("width",function(){return n/e.length}).attr("text-anchor","middle").text(function(e){return"$"+e.contributions});o.selectAll(".year").data(e).enter().append("text").attr("class","year").attr("x",function(t,r){return i(r)+n/e.length/2}).attr("y",function(e){return r}).attr("dy","-1em").attr("width",function(){return n/e.length}).attr("text-anchor","middle").text(function(e){return e.year})}function drawPieChart(e,t){function l(){o.value(function(e){return e[value]});path=path.data(o);path.transition().duration(750).attrTween("d",c)}function c(e){var t=d3.interpolate(this._current,e);this._current=t(0);return function(e){return u(t(e))}}var n=$(t).width(),r=$(t).height(),i=Math.min(n,r)/2,s=d3.scale.category20(),o=d3.layout.pie().value(function(e){return e.contributions}).sort(null),u=d3.svg.arc().innerRadius(i*.25).outerRadius(i*1),a=d3.select(t).append("svg").attr("width",n).attr("height",r).append("g").attr("transform","translate("+n/2+","+r/2+")"),f=a.datum(e).selectAll(".arc").data(o).enter().append("g").attr("class","arc");f.append("path").attr("fill",function(e,t){return s(t)}).attr("d",u).each(function(e){this._current=e});f.append("text").attr("transform",function(e){return"translate("+u.centroid(e)+")"}).attr("dy",".35em").style("text-anchor","middle").text(function(e){return e.data.label});d3.selectAll("input").on("change",l)}$(function(){initGraph();$("#infocard").hide();$("#infocard .close").click(function(){resetGraph()});$("#pull").click(function(e){$(".navlist").slideToggle();e.preventDefault()});$(window).resize(function(){$(window).width()>320&&$(".navlist").is(":hidden")&&$(".navlist").removeAttr("style")})});$.extend(NodeViz.prototype,{graphLoaded:function(){},afterInit:function(){}});$.extend(GraphList.prototype,{listNodeEntry:function(e){var t,n="";e.label?t=e.label:t=e.id;var r="",i="<span class='chip "+(typeof e.party!="undefined"?e.party:"contrib_"+e.contributor_type)+"'></span>",s=typeof e.image!="undefined"&&e.image!="null"?"<img src='"+e.image+"' style='width: 20px; border: 1px solid #666;'/>":"";if(e.type=="candidates"){if(e.party){r="<span class='info'>"+e.party+"</span>";r+="<div class='details'>					<a class='profile_link' href='?candidate_ids="+e.id+"'><img class='link_icon' src='images/go-next.png'/>Profile</a>					<a class='nimsp_link' href='http://www.followthemoney.org/database/uniquecandidate.phtml?uc="+e.unique_candidate_id+"' target='_new'><img class='link_icon' src='images/go-next.png'/>NIMSP Profile</a>				</div>"}}else{var o="Unknown";e.industry!="--"&&(o=e.industry);r+="<a class='profile_link' href='?company_ids="+e.id+"'><img class='link_icon' src='images/go-next.png'/>Profile</a>";r+="<span class='industry'>"+o+"</span><br style='clear:both'/>"}return s+"<span class='label'>"+t+"</span><span class='amount'>$"+format(Math.round(e.total_dollars))+"</span><br/>"+i+r},listSubNodeEntry:function(e,t,n,r){var i,s=r=="to"?"to_node_item":"from_node_item";e.label?i=e.label:i=e.id;var o="Uncategorized",u=this.NodeViz.data.edges[e.relatedNodes[t.id][0]];e.type=="candidates"?e.party&&(o=e.party):e.contributor_type&&(e.contributor_type=="I"?o="Individual":e.contributor_type=="C"&&(o="PAC"));o="<span class='info'>"+o+"</span>";var a="<span class='chip "+(typeof e.party!="undefined"?e.party:"contrib_"+e.contributor_type)+"'></span>",f="<span class='details_link'><img src='NodeViz/icons/magnifier.png' alt='View Details' title='View Details'/></span>";return"<span class='"+s+" label' onclick=\"gf.selectNode('"+e.id+"'); gf.panToNode('"+e.id+"');\">"+i+"</span><span class='amount'>$"+format(Math.round(u.value))+"</span><br/>"+a+o+f},sublistHeader:function(e,t,n){var r="Recipients";n=="to"&&(r="Donors");return"<div class='sublist_header'>"+r+"</div>"}});